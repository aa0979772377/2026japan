<!DOCTYPE html>
<html lang="zh-TW">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>2026 KYOTO OSAKA WINTER GUIDE</title>
   <script src="https://cdn.tailwindcss.com"></script>
   <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&family=Zen+Old+Mincho:wght@400;700;900&family=Noto+Sans+TC:wght@300;400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">

<script src="https://font.emtech.cc/webfont.js"></script>
<script>emfont.load('GenSenRoundedTW');</script> 

   <!-- FontAwesome for Icons -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

   <style>

/* 【新增】: 在動畫期間強制將頁面提到最上層 (z-index)，防止被蓋住而閃爍 */
.page.flipping {
    z-index: 9999 !important; 
}
       /* --- 核心變數 --- */
       :root {
           --book-width: 90vw; /* 手機版寬度 */
           --book-height: 85vh;
           --page-bg: #fdfbf7; /* 紙張米色 */
           --gold-light: #fbf5b7;
           --gold-dark: #bf953f;
           --deep-blue: #1e293b;
           --accent-red: #be123c;
       }

       /* 電腦版尺寸調整 */
       @media (min-width: 768px) {
           :root {
               --book-width: 800px;
               --book-height: 90vh;
               --max-book-height: 800px;
           }
       }

       @media (min-width: 1024px) {
           :root {
               --book-width: 1000px; /* 展開後的寬度 */
           }
       }

       body {
           font-family: 'GenSenRoundedTW', 'Noto Sans TC', sans-serif; 
           background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #172554 100%);
           margin: 0;
           padding: 0;
           overflow: hidden; /* 防止捲動，專注於書本 */
           display: flex;
           justify-content: center;
           align-items: center;
           height: 100vh;
           perspective: 1500px; /* 3D 視角 */
       }

       /* --- 雪花特效 --- */
       #snow-canvas {
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           pointer-events: none;
           z-index: 50;
       }

       /* --- 書本容器 --- */
       .book {
           width: var(--book-width);
           height: var(--book-height);
           max-height: var(--max-book-height);
           position: relative;
           transform-style: preserve-3d;
           transition: transform 0.8s cubic-bezier(0.25, 1, 0.5, 1);
           box-shadow: 0 20px 50px rgba(0,0,0,0.5);
       }

       /* 翻頁邏輯: 每一頁 */
       .page {
           position: absolute;
           width: 100%;
           height: 100%;
           top: 0;
           left: 0;
           background: var(--page-bg);
           border-radius: 4px 16px 16px 4px; /* 書本邊緣圓角 */
           overflow: hidden;
           transform-origin: left center; /* 以左側為軸心旋轉 */
           transform-style: preserve-3d;
           transition: transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);

will-change: transform, z-index;

transform: translateZ(0);`

           z-index: 1;
           box-shadow: inset 0 0 30px rgba(0,0,0,0.05); /* 紙張質感 */
           border-left: 2px solid rgba(0,0,0,0.1);
       }

       /* 翻頁狀態 */
       .page.flipped {
           transform: rotateY(-180deg);
           z-index: 0;
       }

       /* 頁面正反面 */
       .page-front, .page-back {
           position: absolute;
           width: 100%;
           height: 100%;
           top: 0;
           left: 0;
           backface-visibility: hidden; /* 背面隱藏 */
           background: var(--page-bg);
           overflow: hidden;
       }

       /* 背面需要旋轉 180 度才能正確顯示 */
       .page-back {
           transform: rotateY(180deg);
           background: #f8f5f0;
           border-radius: 16px 4px 4px 16px;
           border-right: 2px solid rgba(0,0,0,0.1);
           border-left: none;
       }
       
       /* 為了讓單頁模式也能運作，這裡簡化為所有頁面都是"右頁"翻到"左頁"的概念
          在寬螢幕下，可以做雙頁顯示，但為了手機相容性，採用單頁堆疊翻頁模式更穩健 */

       /* --- 封面特效 --- */
       .cover-page {
           background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
           color: #fff;
           display: flex;
           flex-direction: column;
           justify-content: center;
           align-items: center;
           border: 8px solid #bf953f; /* 金邊 */
           box-shadow: inset 0 0 50px #000;
       }

       .gold-text {
           font-family: 'Playfair Display', serif;
           background: linear-gradient(45deg, #bf953f, #fbf5b7, #bf953f, #fbf5b7, #bf953f);
           background-size: 200% auto;
           color: transparent;
           -webkit-background-clip: text;
           background-clip: text;
           animation: shine 4s linear infinite;
           text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
       }

       @keyframes shine {
           to {
               background-position: 200% center;
           }
       }

       /* --- 內頁設計 --- */
       .inner-layout {
           display: flex;
           flex-direction: column;
           height: 100%;
       }

       .page-header {
           flex-shrink: 0;
           padding: 1.5rem;
           background: linear-gradient(to bottom, #fff 0%, #fdfbf7 100%);
           border-bottom: 1px solid rgba(0,0,0,0.05);
           position: relative;
       }

       /* 日式紋樣背景裝飾 */
       .japanese-pattern {
           position: absolute;
           top: 0;
           right: 0;
           width: 150px;
           height: 150px;
           opacity: 0.1;
           background-image: radial-gradient(#be123c 2px, transparent 2px);
           background-size: 10px 10px;
           pointer-events: none;
       }

       .day-illustration {
           width: 100%;
           height: 200px;
           object-fit: cover;
           border-radius: 8px;
           box-shadow: 0 4px 6px rgba(0,0,0,0.1);
           margin-bottom: 1rem;
           filter: sepia(20%) contrast(90%); /* 復古濾鏡 */
           transition: all 0.5s ease;
       }
       .day-illustration:hover {
           filter: sepia(0%) contrast(100%);
           transform: scale(1.01);
       }

       /* --- 行程時間軸 --- */
       .timeline-container {
           flex-grow: 1;
           overflow-y: auto;
           padding: 1rem 2rem;
           position: relative;
           /* 隱藏捲軸但可捲動 */
           scrollbar-width: thin;
           scrollbar-color: #cbd5e1 transparent;
       }
       .timeline-container::-webkit-scrollbar {
           width: 6px;
       }
       .timeline-container::-webkit-scrollbar-thumb {
           background-color: #cbd5e1;
           border-radius: 3px;
       }

       .timeline-line {
           position: absolute;
           left: 2.75rem; /* 對齊圓點 */
           top: 2rem;
           bottom: 2rem;
           width: 2px;
           background: #cbd5e1;
           z-index: 0;
       }

       .timeline-item {
           position: relative;
           margin-bottom: 2rem;
           display: flex;
           align-items: flex-start;
           z-index: 10;
       }

       .time-badge {
           flex-shrink: 0;
           width: 60px;
           text-align: right;
           padding-right: 1rem;
           font-family: 'Roboto Mono', monospace;
           font-weight: 700;
           color: #64748b;
           font-size: 0.9rem;
           padding-top: 0.25rem;
       }

       .timeline-dot {
           flex-shrink: 0;
           width: 12px;
           height: 12px;
           border-radius: 50%;
           background: #fff;
           border: 3px solid #64748b;
           margin-top: 0.5rem;
           margin-left: -5px; /* 校正位置 */
           position: relative;
           z-index: 20;
       }

       .timeline-content {
           flex-grow: 1;
           margin-left: 1.5rem;
           background: #fff;
           border-radius: 12px;
           padding: 1rem;
           box-shadow: 0 2px 4px rgba(0,0,0,0.05);
           border: 1px solid rgba(0,0,0,0.05);
           transition: transform 0.2s;

    font-family: 'GenSenRoundedTW', 'Noto Sans TC', sans-serif; 
       }
       .timeline-content:active {
           transform: scale(0.98);
       }

       /* 分類樣式 */
       .type-transit .timeline-dot { border-color: #3b82f6; background: #eff6ff; }
       .type-transit .timeline-content { border-left: 4px solid #3b82f6; background: #f8fafc; }
       
       .type-spot .timeline-dot { border-color: #be123c; background: #fff1f2; }
       .type-spot .timeline-content { border-left: 4px solid #be123c; }

       .type-food .timeline-dot { border-color: #d97706; background: #fffbeb; }
       .type-food .timeline-content { border-left: 4px solid #d97706; }

       .type-hotel .timeline-dot { border-color: #475569; background: #f1f5f9; }
       .type-hotel .timeline-content { border-left: 4px solid #475569; background: #f8fafc; }

       /* --- 翻頁控制 --- */
       .controls {
           position: fixed;
           bottom: -500px;
           left: 50%;
           transform: translateX(-50%);
           display: flex;
           gap: 20px;
           z-index: 100;
       }
       .control-btn {
           background: rgba(255, 255, 255, 0.2);
           backdrop-filter: blur(5px);
           border: 1px solid rgba(255, 255, 255, 0.3);
           color: white;
           padding: 10px 20px;
           border-radius: 30px;
           cursor: pointer;
           transition: all 0.3s;
           font-family: 'Zen Old Mincho', serif;
           display: flex;
           align-items: center;
           gap: 8px;
       }
       .control-btn:hover {
           background: rgba(255, 255, 255, 0.4);
           transform: translateY(-2px);
       }
       .control-btn:disabled {
           opacity: 0.3;
           cursor: not-allowed;
           transform: none;
       }

       /* 頁碼 */
       .page-number {
           position: absolute;
           bottom: 1rem;
           right: 1.5rem;
           font-family: 'Playfair Display', serif;
           font-size: 0.9rem;
           color: #94a3b8;
       }
       
       .illustration-caption {
           font-size: 0.7rem;
           color: #64748b;
           text-align: center;
           font-style: italic;
           margin-top: -0.5rem;
           margin-bottom: 1rem;
       }

       /* 書籤效果 */
       .bookmark {
           position: absolute;
           top: -10px;
           right: 20px;
           width: 30px;
           height: 60px;
           background: #be123c;
           box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
           z-index: 50;
       }
       .bookmark::after {
           content: '';
           position: absolute;
           bottom: 0;
           left: 0;
           border-left: 15px solid #be123c;
           border-right: 15px solid #be123c;
           border-bottom: 15px solid transparent;
       }
   </style>
</head>
<body>

   <!-- 雪花畫布 -->
   <canvas id="snow-canvas"></canvas>

   <!-- 書本主體 -->
   <div class="book" id="book">
       <!-- 頁面將由 JS 動態生成 -->
   </div>

   <!-- 控制按鈕 -->
   <div class="controls">
       <button class="control-btn" id="prevBtn" onclick="flipPrev()"><i class="fas fa-chevron-left"></i> 上一頁</button>
       <button class="control-btn" id="nextBtn" onclick="flipNext()">下一頁 <i class="fas fa-chevron-right"></i></button>
   </div>

   <script>

let isFlipping = false; // 【新增】：狀態鎖，防止動畫期間重複點擊導致錯誤
const TRANSITION_DURATION = 800; // 與 CSS 的 0.8s 匹配

       // --- 1. 資料區 (完全鎖定，不變動) ---
       window.getRefinedItineraryData = () => {
           return {
               "Day1": [
                   { id: 'd1_1', time: '02:20', activity: '統聯客運（往桃園機場）', details: '02:01從台中站發車\n(預估抵達)朝馬站02:20 桃園機場04:20', transport: '客運', duration: '2hr ', type: '交通', dep_time: '02:20', arr_time: '04:20', dep_loc: '朝馬站', arr_loc: '桃園機場', note: '02:01從台中站發車' },
                   { id: 'd1_2', time: '04:20', activity: '桃園國際機場T2 報到', details: '中華航空C10156\n桃園8:05關西11:35', transport: '停留', duration: '3hr 45min', type: '彈性', dep_time: '04:20', arr_time: '08:05', dep_loc: '桃園機場', arr_loc: '登機口', note: '空閒時間設定e-sim<br>國際航班請預留充足時間報到/安檢' },
                   { id: 'd1_3', time: '08:05', activity: '中華航空CI0156 (飛往關西)', details: '桃園8:05關西11:35', transport: '飛機', duration: '3hr 30min', type: '交通', dep_time: '08:05', arr_time: '11:35', dep_loc: '桃園機場', arr_loc: '關西機場', note: '' },
                   { id: 'd1_4', time: '11:35', activity: '關西國際機場T1 出關', details: '約停留2hr出關\n(取行李時劃位0.5hr後的JR HARUKA)', transport: '停留', duration: '2hr 39min', type: '彈性', dep_time: '11:35', arr_time: '14:14', dep_loc: '機場', arr_loc: 'JR劃位', note: '一人負責找行李 一人負責劃位JR HARUKA' },
                   { id: 'd1_5', time: '14:14', activity: 'JR HARUKA (往京都)', details: '關西機場14:14 京都15:34', transport: 'JR', duration: '1hr 20min', type: '交通', dep_time: '14:14', arr_time: '15:34', dep_loc: '關西機場', arr_loc: '京都', note: '' },
                   { id: 'd1_6', time: '15:34', activity: '步行 (往地鐵烏丸線)', details: '步行5min到地鐵烏丸線', transport: '步行', duration: '5min', type: '交通', dep_time: '15:34', arr_time: '15:39', dep_loc: '京都車站', arr_loc: '地鐵入口', note: '' },
                   { id: 'd1_6_wait', time: '15:39', activity: '步行後等候 地鐵烏丸線', details: '等候緩衝時間 (預留 3 分鐘)', transport: '等待', duration: '3min', type: '彈性', dep_time: '15:39', arr_time: '15:42', dep_loc: '地鐵入口', arr_loc: '地鐵入口', note: '等待地鐵烏丸線15:42班次' },
                   { id: 'd1_7', time: '15:42', activity: '地鐵烏丸線 (往國際會館)', details: '京都15:42烏丸御池15:47', transport: '地鐵', duration: '5min', type: '交通', dep_time: '15:42', arr_time: '15:47', dep_loc: '京都', arr_loc: '烏丸御池', note: '' },
                   { id: 'd1_8', time: '15:47', activity: '步行 (往酒店)', details: '步行8min到京都御池insomnia酒店', transport: '步行', duration: '8min', type: '交通', dep_time: '15:47', arr_time: '15:55', dep_loc: '烏丸御池', arr_loc: '酒店', note: '' },
                   { id: 'd1_9', time: '15:55', activity: '京都御池insomnia酒店', details: 'Check-in辦理入住手續並稍作休息 30min', transport: '住宿', duration: '41min', type: '住宿', dep_time: '15:55', arr_time: '16:25', dep_loc: '酒店', arr_loc: '出發', note: 'Check-in後休息' },
                   { id: 'd1_9_walk', time: '16:25', activity: '步行 (往地鐵烏丸線)', details: '步行5min到地鐵烏丸線', transport: '步行', duration: '5min', type: '交通', dep_time: '16:25', arr_time: '16:30', dep_loc: '酒店', arr_loc: '烏丸御池站', note: '' },                    
                   { id: 'd1_10_wait', time: '16:30', activity: '步行後等候 地鐵烏丸線', details: '等候緩衝時間 (預留 6 分鐘)', transport: '等待', duration: '6min', type: '彈性', dep_time: '16:30', arr_time: '16:36', dep_loc: '烏丸御池', arr_loc: '烏丸御池', note: '等待地鐵烏丸線16:36 班次' },
                   { id: 'd1_10', time: '16:36', activity: '地鐵烏丸線 (往新田邊)', details: '烏丸御池16:36 五條16:40', transport: '地鐵', duration: '4min', type: '交通', dep_time: '16:36', arr_time: '16:40', dep_loc: '烏丸御池', arr_loc: '五條', note: '' },
                   { id: 'd1_11', time: '16:40', activity: '步行 (往五條天神宮)', details: '步行13min到五條天神宮', transport: '步行', duration: '15min', type: '交通', dep_time: '16:40', arr_time: '16:55', dep_loc: '五條', arr_loc: '天神宮', note: '' },
                   { id: 'd1_12', time: '16:55', activity: '五條天神宮', details: '參觀40min', transport: '停留', duration: '40min', type: '景點', dep_time: '16:55', arr_time: '17:35', dep_loc: '天神宮', arr_loc: '天神宮', note: '祈求平安 / 小巧精緻的神社' },
                   { id: 'd1_13', time: '17:35', activity: '步行 (往GU)', details: '步行20min到GU', transport: '步行', duration: '20min', type: '交通', dep_time: '17:35', arr_time: '17:55', dep_loc: '天神宮', arr_loc: 'GU', note: '' },
                   { id: 'd1_14', time: '17:55', activity: 'GU Kyōto-Yodobashi', details: '採購2hr ', transport: '停留', duration: '2hr ', type: '逛街', dep_time: '17:55', arr_time: '19:55', dep_loc: 'GU', arr_loc: 'GU', note: '採購服飾清單' },
                   { id: 'd1_15_walk', time: '19:55', activity: '步行 (往京都塔)', details: '步行5min到京都塔', transport: '步行', duration: '5min', type: '交通', dep_time: '19:55', arr_time: '20:00', dep_loc: 'GU', arr_loc: '京都塔', note: '' },
                   { id: 'd1_15', time: '20:00', activity: '京都塔', details: '拍照10min', transport: '停留', duration: '10min', type: '景點', dep_time: '20:00', arr_time: '20:10', dep_loc: '京都塔', arr_loc: '京都塔', note: '欣賞夜景' },
                   { id: 'd1_16_walk', time: '20:10', activity: '步行 (往炸牛排 京都勝牛)', details: '步行5min到京都勝牛', transport: '步行', duration: '5min', type: '交通', dep_time: '20:10', arr_time: '20:15', dep_loc: '京都塔', arr_loc: '京都勝牛', note: '' },
                   { id: 'd1_16', time: '20:15', activity: '炸牛排 京都勝牛', details: '晚餐1hr ', transport: '停留', duration: '1hr ', type: '吃飯', dep_time: '20:15', arr_time: '21:15', dep_loc: '京都勝牛', arr_loc: '京都勝牛', note: '人氣炸牛排 / 預計用餐1hr' },
                   { id: 'd1_17_walk', time: '21:15', activity: '步行 (往地鐵烏丸線)', details: '步行5min到地鐵烏丸線', transport: '步行', duration: '5min', type: '交通', dep_time: '21:15', arr_time: '21:20', dep_loc: '京都勝牛', arr_loc: '京都車站', note: '' },
                   { id: 'd1_17_wait', time: '21:20', activity: '步行後等候 地鐵烏丸線', details: '等候緩衝時間 (預留 6分鐘)', transport: '等待', duration: '4min', type: '彈性', dep_time: '21:20', arr_time: '21:26', dep_loc: '京都車站', arr_loc: '京都車站', note: '等待地鐵烏丸線21:26班次' },
                   { id: 'd1_17', time: '21:26', activity: '地鐵烏丸線 (往國際會館)', details: '京都21:26 烏丸御池21:31', transport: '地鐵', duration: '5min', type: '交通', dep_time: '21:26', arr_time: '21:31', dep_loc: '京都', arr_loc: '烏丸御池', note: '' },
                   { id: 'd1_18', time: '21:31', activity: '步行 (回酒店)', details: '步行8min到京都御池insomnia酒店', transport: '步行', duration: '8min', type: '交通', dep_time: '21:31', arr_time: '21:39', dep_loc: '烏丸御池', arr_loc: '酒店', note: '' },
                   { id: 'd1_19', time: '21:40', activity: '京都御池insomnia酒店', details: '回到酒店休息/自由活動', transport: '住宿', duration: 'N/A', type: '住宿', dep_time: '21:40', arr_time: 'N/A', dep_loc: '酒店', arr_loc: 'N/A', note: '結束 Day 1' },
               ],
               "Day2": [
                   { id: 'd2_0', time: '06:00', activity: '京都御池insomnia酒店', details: '早上從酒店出發', transport: '住宿', duration: '0min', type: '住宿', dep_time: '06:00', arr_time: '06:00', dep_loc: '酒店', arr_loc: '酒店', note: '開始 Day 2' },
                   { id: 'd2_0_walk', time: '06:00', activity: '步行 (往地鐵東西線)', details: '步行5min到地鐵東西線', transport: '步行', duration: '5min', type: '交通', dep_time: '06:00', arr_time: '06:05', dep_loc: '酒店', arr_loc: '地鐵站', note: '' },
                   { id: 'd2_0_wait', time: '06:05', activity: '步行後等候 地鐵東西線', details: '等候緩衝時間 (預留 6 分鐘)', transport: '等待', duration: '6min', type: '彈性', dep_time: '06:05', arr_time: '06:11', dep_loc: '地鐵站', arr_loc: '地鐵站', note: '等待地鐵東西線06:11班次' },
                   { id: 'd2_1', time: '06:11', activity: '地鐵東西線 (往太秦天神川)', details: '烏丸御池06:11 二條06:15', transport: '地鐵', duration: '4min', type: '交通', dep_time: '06:11', arr_time: '06:15', dep_loc: '烏丸御池', arr_loc: '二條', note: '早起前往嵐山避人潮' },
                   { id: 'd2_1_wait', time: '06:15', activity: '轉乘及等候 JR 嵯峨野線', details: '地鐵抵達二條站，等候 06:30 的 JR 嵯峨野線', transport: '等待', duration: '15min', type: '彈性', dep_time: '06:15', arr_time: '06:30', dep_loc: '二條', arr_loc: '二條', note: '轉乘JR嵯峨野線06:30班次' },
                   { id: 'd2_2', time: '06:30', activity: 'JR嵯峨野線 (往龜岡)', details: '二條06:30 嵯峨嵐山06:39', transport: 'JR', duration: '9min', type: '交通', dep_time: '06:30', arr_time: '06:39', dep_loc: '二條', arr_loc: '嵯峨嵐山', note: '' },
                   { id: 'd2_3_walk', time: '06:39', activity: '步行 (往竹林小徑)', details: '步行15min到嵐山竹林', transport: '步行', duration: '16min', type: '交通', dep_time: '06:39', arr_time: '06:55', dep_loc: '嵯峨嵐山', arr_loc: '竹林小徑', note: '' },
                   { id: 'd2_4', time: '06:55', activity: '嵐山竹林小徑', details: '停留1hr ', transport: '停留', duration: '1hr ', type: '景點', dep_time: '06:55', arr_time: '07:55', dep_loc: '竹林小徑', arr_loc: '竹林小徑', note: '享受清晨寧靜 / 避開人群' },
                   { id: 'd2_5_walk', time: '07:55', activity: '步行 (往御髪神社)', details: '從竹林步行至御髪神社 (約5-10min)', transport: '步行', duration: '5min', type: '交通', dep_time: '07:55', arr_time: '08:00', dep_loc: '竹林小徑', arr_loc: '御髪神社', note: '' },
                   { id: 'd2_5', time: '08:00', activity: '御髪神社', details: '參觀20min', transport: '停留', duration: '20min', type: '景點', dep_time: '08:00', arr_time: '08:20', dep_loc: '御髪神社', arr_loc: '御髪神社', note: '日本唯一的頭髮神社' },
                   { id: 'd2_6_walk', time: '08:20', activity: '步行 (往野宮神社)', details: '步行10min到野宮神社', transport: '步行', duration: '10min', type: '交通', dep_time: '08:20', arr_time: '08:30', dep_loc: '御髪神社', arr_loc: '野宮神社', note: '' },
                   { id: 'd2_6', time: '08:30', activity: '野宮神社', details: '參觀30min', transport: '停留', duration: '30min', type: '景點', dep_time: '08:30', arr_time: '09:00', dep_loc: '野宮神社', arr_loc: '野宮神社', note: '祈求良緣' },
                   { id: 'd2_7_walk', time: '09:00', activity: '步行 (往天龍寺)', details: '步行5min到天龍寺', transport: '步行', duration: '5min', type: '交通', dep_time: '09:00', arr_time: '09:05', dep_loc: '野宮神社', arr_loc: '天龍寺', note: '' },
                   { id: 'd2_7', time: '09:05', activity: '天龍寺', details: '參觀1.5hr\n世界遺產曹源池庭園', transport: '停留', duration: '1hr 30min', type: '景點', dep_time: '09:05', arr_time: '10:35', dep_loc: '天龍寺', arr_loc: '天龍寺', note: '世界遺產' },
                   { id: 'd2_8_walk', time: '10:35', activity: '步行 (往渡月橋)', details: '步行10min到渡月橋', transport: '步行', duration: '10min', type: '交通', dep_time: '10:35', arr_time: '10:45', dep_loc: '天龍寺', arr_loc: '渡月橋', note: '' },
                   { id: 'd2_8', time: '10:45', activity: '渡月橋', details: '停留1hr \n拍照打卡熱點', transport: '停留', duration: '1hr ', type: '景點', dep_time: '10:45', arr_time: '11:45', dep_loc: '渡月橋', arr_loc: '渡月橋', note: '嵐山地標' },
                   { id: 'd2_9_walk', time: '11:45', activity: '步行 (往JR 嵯峨野線)', details: '步行15min到JR 嵯峨野線', transport: '步行', duration: '15min', type: '交通', dep_time: '11:45', arr_time: '12:00', dep_loc: '渡月橋', arr_loc: '嵯峨嵐山', note: '' },
                   { id: 'd2_1_wait', time: '12:00', activity: '步行後等候 JR 嵯峨野線', details: '等候12:17的 JR 嵯峨野線', transport: '等待', duration: '17min', type: '彈性', dep_time: '12:00', arr_time: '12:17', dep_loc: '嵯峨嵐山', arr_loc: '嵯峨嵐山', note: '轉乘JR嵯峨野線12:17班次' },
                   { id: 'd2_9', time: '12:17', activity: 'JR嵯峨野線 (往京都)', details: '嵯峨嵐山12:17 二條12:26', transport: 'JR', duration: '9min', type: '交通', dep_time: '12:17', arr_time: '12:26', dep_loc: '嵯峨嵐山', arr_loc: '二條', note: '' },
                   { id: 'd2_10', time: '12:26', activity: '步行 (往二條城)', details: '步行9min', transport: '步行', duration: '9min', type: '交通', dep_time: '12:26', arr_time: '12:35', dep_loc: '二條站', arr_loc: '二條城', note: '' },
                   { id: 'd2_11', time: '12:35', activity: '二條城', details: '停留1.5hr\n參觀德川幕府大政奉還處', transport: '停留', duration: '1hr 30min', type: '景點', dep_time: '12:35', arr_time: '14:05', dep_loc: '二條城', arr_loc: '二條城', note: '德川幕府歷史遺址' },
                   { id: 'd2_12_walk', time: '14:05', activity: '步行 (往地鐵東西線)', details: '步行8min到地鐵東西線', transport: '步行', duration: '8min', type: '交通', dep_time: '14:05', arr_time: '14:13', dep_loc: '二條城', arr_loc: '二條城前', note: '' },
                   { id: 'd2_12_wait', time: '14:13', activity: '步行後等候 地鐵東西線', details: '等候緩衝時間 (預留 8 分鐘)', transport: '等待', duration: '8min', type: '彈性', dep_time: '14:13', arr_time: '14:21', dep_loc: '二條城前', arr_loc: '二條城前', note: '等待地鐵東西線14:21班次' },
                   { id: 'd2_12', time: '14:21', activity: '地鐵東西線 (往六地藏)', details: '二條城前14:21 三條京阪14:26', transport: '地鐵', duration: '5min', type: '交通', dep_time: '14:21', arr_time: '14:26', dep_loc: '二條城前', arr_loc: '三條京阪', note: '' },
                   { id: 'd2_13', time: '14:26', activity: '步行 (往花見小路)', details: '步行9min到花見小路', transport: '步行', duration: '9min', type: '交通', dep_time: '14:26', arr_time: '14:35', dep_loc: '三條京阪', arr_loc: '花見小路', note: '' },
                   { id: 'd2_14', time: '14:35', activity: '花見小路', details: '停留50min\n運氣好可以看到藝伎', transport: '停留', duration: '50min', type: '景點', dep_time: '14:35', arr_time: '15:25', dep_loc: '花見小路', arr_loc: '花見小路', note: '尋找藝伎的蹤影' },
                   { id: 'd2_15_walk', time: '15:25', activity: '步行 (往祇園白川)', details: '步行5min到祇園白川', transport: '步行', duration: '5min', type: '交通', dep_time: '15:25', arr_time: '15:30', dep_loc: '花見小路', arr_loc: '祇園白川', note: '' },
                   { id: 'd2_15', time: '15:30', activity: '祇園白川', details: '停留 50min', transport: '停留', duration: '50min', type: '景點', dep_time: '15:30', arr_time: '16:20', dep_loc: '祇園白川', arr_loc: '祇園白川', note: '京都小橋流水景觀' },
                   { id: 'd2_16_walk', time: '16:20', activity: '步行 (往八坂神社)', details: '步行10min到八坂神社', transport: '步行', duration: '10min', type: '交通', dep_time: '16:20', arr_time: '16:30', dep_loc: '祇園白川', arr_loc: '八坂神社', note: '' },
                   { id: 'd2_16', time: '16:30', activity: '京都八坂神社', details: '參觀1.5hr', transport: '停留', duration: '1hr 30min', type: '景點', dep_time: '16:30', arr_time: '18:00', dep_loc: '八坂神社', arr_loc: '八坂神社', note: '京都三大祭典之一' },
                   { id: 'd2_17_walk', time: '18:00', activity: '步行 (往麵屋 豬一)', details: '步行20min到豬一', transport: '步行', duration: '20min', type: '交通', dep_time: '18:00', arr_time: '18:20', dep_loc: '八坂神社', arr_loc: '麵屋豬一', note: '' },
                   { id: 'd2_17', time: '18:20', activity: '麵屋 豬一', details: '晚餐1hr \n人氣排隊名店', transport: '停留', duration: '1hr ', type: '吃飯', dep_time: '18:20', arr_time: '19:20', dep_loc: '麵屋 豬一', arr_loc: '麵屋 豬一', note: '人氣拉麵 / 提前排隊' },
                   { id: 'd2_18_walk', time: '19:20', activity: '步行 (回酒店)', details: '步行28min到京都御池insomnia酒店', transport: '步行', duration: '28min', type: '交通', dep_time: '19:20', arr_time: '19:48', dep_loc: '麵屋豬一', arr_loc: '酒店', note: '' },
                   { id: 'd2_18', time: '19:50', activity: '京都御池insomnia酒店', details: '回到酒店休息/自由活動', transport: '住宿', duration: 'N/A', type: '住宿', dep_time: '19:50', arr_time: 'N/A', dep_loc: '酒店', arr_loc: 'N/A', note: '結束 Day 2' },
               ],
               "Day3": [
                   { id: 'd3_0_start', time: '05:00', activity: '京都御池insomnia酒店', details: '早上從酒店出發', transport: '住宿', duration: '0min', type: '住宿', dep_time: '05:00', arr_time: '05:00', dep_loc: '酒店', arr_loc: '酒店', note: '開始 Day 3' },
                   { id: 'd3_0_taxi', time: '05:00', activity: '計程車 (往二寧坂)', details: '計程車 10min到二年坂', transport: '計程車', duration: '10min', type: '交通', dep_time: '05:00', arr_time: '05:10', dep_loc: '酒店', arr_loc: '二年坂', note: '建議搭乘計程車' },
                   { id: 'd3_1', time: '05:10', activity: '二寧坂(二年坂)', details: '停留20min', transport: '停留', duration: '20min', type: '景點', dep_time: '05:10', arr_time: '05:30', dep_loc: '二年坂', arr_loc: '二年坂', note: '清晨限定 / 避開人潮' },
                   { id: 'd3_2_walk', time: '05:30', activity: '步行 (往三年坂)', details: '步行5min三年坂', transport: '步行', duration: '5min', type: '交通', dep_time: '05:30', arr_time: '05:35', dep_loc: '二年坂', arr_loc: '三年坂', note: '' },
                   { id: 'd3_2', time: '05:35', activity: '產寧坂(三年坂)', details: '停留20min', transport: '停留', duration: '20min', type: '景點', dep_time: '05:35', arr_time: '05:55', dep_loc: '三年坂', arr_loc: '三年坂', note: '摔倒有三年內厄運的傳說' },
                   { id: 'd3_3_walk', time: '05:55', activity: '步行 (往清水寺)', details: '步行10min到清水寺', transport: '步行', duration: '10min', type: '交通', dep_time: '05:55', arr_time: '06:05', dep_loc: '三年坂', arr_loc: '清水寺', note: '' },
                   { id: 'd3_3', time: '06:05', activity: '清水寺', details: '參觀2hr', transport: '停留', duration: '2hr', type: '景點', dep_time: '06:05', arr_time: '08:05', dep_loc: '清水寺', arr_loc: '清水寺', note: '早上較少人 / 國寶清水舞台' },
                   { id: 'd3_4_walk', time: '08:05', activity: '步行 (往京阪本線)', details: '步行20min到京阪本線', transport: '步行', duration: '20min', type: '交通', dep_time: '08:05', arr_time: '08:25', dep_loc: '清水寺', arr_loc: '清水五條', note: '' },
                   { id: 'd3_4_wait', time: '08:25', activity: '步行後等候 京阪本線', details: '等候緩衝時間 (預留 12 分鐘)', transport: '等待', duration: '12min', type: '彈性', dep_time: '08:25', arr_time: '08:37', dep_loc: '清水五條', arr_loc: '清水五條', note: '等待京阪本線08:37班次' },
                   { id: 'd3_4', time: '08:37', activity: '京阪本線 準急行 (往淀屋橋)', details: '清水五條08:37 伏見稻荷08:44', transport: '電車', duration: '7min', type: '交通', dep_time: '08:37', arr_time: '08:44', dep_loc: '清水五條', arr_loc: '伏見稻荷', note: '搭乘京阪本線' },
                   { id: 'd3_5', time: '08:44', activity: '步行 (往伏見稻荷大社)', details: '步行6min到伏見稻荷大社', transport: '步行', duration: '6min', type: '交通', dep_time: '08:44', arr_time: '08:50', dep_loc: '伏見稻荷', arr_loc: '大社', note: '' },
                   { id: 'd3_6', time: '08:50', activity: '伏見稻荷大社', details: '參觀1.5hr', transport: '停留', duration: '1hr 30min', type: '景點', dep_time: '08:50', arr_time: '10:20', dep_loc: '伏見稻荷大社', arr_loc: '伏見稻荷大社', note: '必拍千本鳥居' },
                   { id: 'd3_7_walk', time: '10:20', activity: '步行 (往JR奈良線)', details: '步行5min到JR奈良線', transport: '步行', duration: '5min', type: '交通', dep_time: '10:20', arr_time: '10:25', dep_loc: '伏見稻荷大社', arr_loc: '稻荷', note: '' },
                   { id: 'd3_7_wait', time: '10:25', activity: '步行後等候 JR奈良線', details: '等候緩衝時間 (預留 10 分鐘)', transport: '等待', duration: '10min', type: '彈性', dep_time: '10:25', arr_time: '10:35', dep_loc: '稻荷', arr_loc: '稻荷', note: '等待JR奈良線10:35班次' },
                   { id: 'd3_7', time: '10:35', activity: 'JR奈良線 (往奈良)', details: '稻荷10:35宇治10:52', transport: 'JR', duration: '17min', type: '交通', dep_time: '10:35', arr_time: '10:52', dep_loc: '稻荷', arr_loc: '宇治', note: '' },
                   { id: 'd3_8', time: '10:52', activity: '步行 (往中村藤吉)', details: '步行8min到中村藤吉本店', transport: '步行', duration: '8min', type: '交通', dep_time: '10:52', arr_time: '11:00', dep_loc: '宇治站', arr_loc: '中村藤吉', note: '' },
                   { id: 'd3_9', time: '11:00', activity: '中村藤吉本店 宇治店', details: '午餐1hr (必吃抹茶)', transport: '停留', duration: '1hr', type: '吃飯', dep_time: '11:00', arr_time: '12:00', dep_loc: '中村藤吉', arr_loc: '中村藤吉', note: '必吃抹茶甜點' },
                   { id: 'd3_10_walk', time: '12:00', activity: '步行 (往平等院鳳凰堂)', details: '步行10min到鳳凰堂', transport: '步行', duration: '10min', type: '交通', dep_time: '12:00', arr_time: '12:10', dep_loc: '中村藤吉', arr_loc: '鳳凰堂', note: '' },
                   { id: 'd3_10', time: '12:10', activity: '平等院鳳凰堂', details: '參觀1.5hr', transport: '停留', duration: '1hr 30min', type: '景點', dep_time: '12:10', arr_time: '13:40', dep_loc: '鳳凰堂', arr_loc: '鳳凰堂', note: '十元硬幣上的圖案' },
                   { id: 'd3_11_walk', time: '13:40', activity: '步行 (往宇治神社)', details: '步行10min到宇治神社', transport: '步行', duration: '10min', type: '交通', dep_time: '13:40', arr_time: '13:50', dep_loc: '鳳凰堂', arr_loc: '宇治神社', note: '' },
                   { id: 'd3_11', time: '13:50', activity: '宇治神社(兔子神社)', details: '參觀40min', transport: '停留', duration: '40min', type: '景點', dep_time: '13:50', arr_time: '14:30', dep_loc: '宇治神社', arr_loc: '宇治神社', note: '充滿兔子元素的可愛神社' },
                   { id: 'd3_12_walk', time: '14:30', activity: '步行 (往宇治上神社)', details: '步行5min到宇治上神社', transport: '步行', duration: '5min', type: '交通', dep_time: '14:30', arr_time: '14:35', dep_loc: '宇治神社', arr_loc: '宇治上神社', note: '' },
                   { id: 'd3_12', time: '14:35', activity: '宇治上神社', details: '參觀40min\n世界遺產 / 日本現存最古老的神社建築', transport: '停留', duration: '40min', type: '景點', dep_time: '14:35', arr_time: '15:15', dep_loc: '宇治上神社', arr_loc: '宇治上神社', note: '世界遺產' },
                   { id: 'd3_13_walk', time: '15:15', activity: '步行 (往京阪宇治線)', details: '步行10min到京阪宇治線', transport: '步行', duration: '10min', type: '交通', dep_time: '15:15', arr_time: '15:25', dep_loc: '宇治上神社', arr_loc: '宇治站', note: '' },
                   { id: 'd3_13_wait_2', time: '15:25', activity: '步行後等候 京阪宇治線', details: '等候緩衝時間 (預留 5 分鐘)', transport: '等待', duration: '5min', type: '彈性', dep_time: '15:25', arr_time: '15:30', dep_loc: '宇治站', arr_loc: '宇治站', note: '等待京阪宇治線15:30班次' },
                   { id: 'd3_13', time: '15:30', activity: '京阪宇治線 (往中書島)', details: '宇治15:30 中書島15:56', transport: '電車', duration: '26min', type: '交通', dep_time: '15:30', arr_time: '15:56', dep_loc: '宇治', arr_loc: '中書島', note: '' },
                   // V20 新增：等待京阪本線 (6min)
                   { id: 'd3_13_wait', time: '15:56', activity: '轉乘及等候 京阪本線', details: '抵達中書島，等候 16:02 的特急列車', transport: '等待', duration: '6min', type: '彈性', dep_time: '16:56', arr_time: '16:02', dep_loc: '中書島', arr_loc: '中書島', note: '轉乘京阪本線16:02班次' },
                   { id: 'd3_14', time: '16:02', activity: '京阪本線 特急 (往出町柳)', details: '中書島16:02 祇園四條16:13', transport: '電車', duration: '11min', type: '交通', dep_time: '16:02', arr_time: '16:13', dep_loc: '中書島', arr_loc: '祇園四條', note: '一般特急不需要額外費用' },
                   { id: 'd3_15', time: '16:13', activity: '步行 (往錦市場)', details: '步行12min到錦市場', transport: '步行', duration: '12min', type: '交通', dep_time: '16:13', arr_time: '16:25', dep_loc: '祇園四條', arr_loc: '錦市場', note: '' },
                   { id: 'd3_16', time: '16:25', activity: '錦市場', details: '逛街+晚餐2hr \n京都的廚房', transport: '停留', duration: '2hr ', type: '逛街', dep_time: '16:25', arr_time: '18:25', dep_loc: '錦市場', arr_loc: '錦市場', note: '邊走邊吃 / 京都的廚房' },
                   { id: 'd3_17_walk', time: '18:25', activity: '步行 (往弁慶石)', details: '步行10min到弁慶石', transport: '步行', duration: '10min', type: '交通', dep_time: '18:25', arr_time: '18:35', dep_loc: '錦市場', arr_loc: '弁慶石', note: '' },
                   { id: 'd3_17', time: '18:35', activity: '弁慶石', details: '拍照10min', transport: '停留', duration: '15min', type: '景點', dep_time: '18:35', arr_time: '18:45', dep_loc: '弁慶石', arr_loc: '弁慶石', note: '歷史地標 / 義經公與弁慶的傳說' },
                   { id: 'd3_18_walk', time: '18:45', activity: '步行 (回酒店)', details: '步行15min到京都御池insomnia酒店', transport: '步行', duration: '15min', type: '交通', dep_time: '18:45', arr_time: '19:00', dep_loc: '弁慶石', arr_loc: '酒店', note: '' },
                   { id: 'd3_18', time: '19:00', activity: '京都御池insomnia酒店', details: '回到酒店休息/自由活動', transport: '住宿', duration: 'N/A', type: '住宿', dep_time: '19:00', arr_time: 'N/A', dep_loc: '酒店', arr_loc: 'N/A', note: '結束 Day 3' },
               ],
               "Day4": [
                   // --- 早晨出發 (08:00 - 08:43) ---
                   { id: 'd4_0', time: '08:00', activity: '京都御池insomnia酒店', details: '辦理退房手續並寄放行李，準備出發', transport: '住宿', duration: '0min', type: '住宿', dep_time: '08:00', arr_time: '08:00', dep_loc: '酒店', arr_loc: '酒店', note: '開始 Day 4 / 寄放行李' },
                   
                   { id: 'd4_0_walk', time: '08:00', activity: '步行 (往地鐵烏丸線)', details: '步行5min到地鐵烏丸線', transport: '步行', duration: '5min', type: '交通', dep_time: '08:00', arr_time: '08:05', dep_loc: '酒店', arr_loc: '烏丸御池站', note: '' },
                   
                   { id: 'd4_0_wait', time: '08:05', activity: '步行後等候 地鐵烏丸線', details: '等候緩衝時間 (預留 8 分鐘)', transport: '等待', duration: '8min', type: '彈性', dep_time: '08:05', arr_time: '08:13', dep_loc: '烏丸御池', arr_loc: '烏丸御池', note: '等待地鐵烏丸線08:13 班次' },

                   { id: 'd4_1', time: '08:13', activity: '地鐵烏丸線 (往國際會館)', details: '烏丸御池08:13 北大路08:19', transport: '地鐵', duration: '6min', type: '交通', dep_time: '08:13', arr_time: '08:19', dep_loc: '烏丸御池', arr_loc: '北大路', note: '' },

                   { id: 'd4_2_walk', time: '08:19', activity: '步行轉乘 (往巴士總站)', details: '步行2min到北大路巴士總站', transport: '步行', duration: '2min', type: '交通', dep_time: '08:19', arr_time: '08:21', dep_loc: '北大路站', arr_loc: '巴士總站', note: '' },

                   { id: 'd4_2_wait', time: '08:21', activity: '等候 205/204 City Bus', details: '等候 08:28 班次', transport: '等待', duration: '7min', type: '彈性', dep_time: '08:21', arr_time: '08:28', dep_loc: '巴士總站', arr_loc: '巴士總站', note: '等待205 City Bus 08:28班次<br>E搭乘處(205) / G搭乘處(204)' },

                   { id: 'd4_2', time: '08:28', activity: '205 City Bus (往西大路七條、京都站)', details: '北大路巴士總站08:28 金閣寺道08:39', transport: '公車', duration: '11min', type: '交通', dep_time: '08:28', arr_time: '08:39', dep_loc: '北大路', arr_loc: '金閣寺道', note: 'OR 204 City Bus (往北大路通、金閣寺、西之京圓町）<br> E搭乘處(205) OR G搭乘處(204)' },

                   { id: 'd4_3_walk', time: '08:39', activity: '步行 (往金閣寺)', details: '步行4min到金閣寺', transport: '步行', duration: '4min', type: '交通', dep_time: '08:39', arr_time: '08:43', dep_loc: '金閣寺道', arr_loc: '金閣寺', note: '' },

                   // --- 金閣寺區域 (修正處) ---
                   {
                       id: 'd4_3',
                       time: '09:00',
                       activity: '金閣寺',
                       details: '抵達時間08:43，營業時間09:00\n參觀2hr ',
                       transport: '停留',
                       duration: '2hr ', // 09:00 到 11:00
                       type: '景點',
                       dep_time: '09:00',
                       arr_time: '11:00',
                       dep_loc: '金閣寺',
                       arr_loc: '金閣寺',
                       note: '正式開放時間是09:00'
                   },

                   {
                       id: 'd4_4_walk',
                       time: '11:00',
                       activity: '步行 (往公車站)',
                       details: '步行4min到公車站',
                       transport: '步行',
                       duration: '4min',
                       type: '交通',
                       dep_time: '11:00',
                       arr_time: '11:04',
                       dep_loc: '金閣寺',
                       arr_loc: '金閣寺道',
                       note: ''
                   },
                   
                   {
                       id: 'd4_4_wait',
                       time: '11:04',
                       activity: '步行後等候 205 City Bus',
                       details: '等候緩衝時間 (預留 4 分鐘)',
                       transport: '等待',
                       duration: '4min',
                       type: '彈性',
                       dep_time: '11:04',
                       arr_time: '11:08',
                       dep_loc: '金閣寺道',
                       arr_loc: '金閣寺道',
                       note: '等待205 City Bus 11:08 班次'
                   },

                   {
                       id: 'd4_4',
                       time: '11:08',
                       activity: '205 City Bus (往洛北高校、京都站)',
                       details: '金閣寺道11:08 下鴨神社前11:28',
                       transport: '公車',
                       duration: '20min',
                       type: '交通',
                       dep_time: '11:08',
                       arr_time: '11:28',
                       dep_loc: '金閣寺道',
                       arr_loc: '下鴨神社前',
                       note: 'C乘車處'
                   },

                   // --- 下鴨神社區域 (後續行程時間未變，只需接續) ---
                   { id: 'd4_5', time: '11:30', activity: '賀茂御祖神社 (下鴨神社)', details: '參觀1hr', transport: '停留', duration: '1hr', type: '景點', dep_time: '11:30', arr_time: '12:30', dep_loc: '下鴨神社', arr_loc: '下鴨神社', note: '世界遺產<br>相生社可購買戒指御守<br>除了主殿商店外 周邊的兩三間商店可以買到其他季節御守（雜太社旁商店）' },

                   { id: 'd4_6_walk', time: '12:30', activity: '步行 (往河合神社)', details: '步行5min到河合神社', transport: '步行', duration: '5min', type: '交通', dep_time: '12:30', arr_time: '12:35', dep_loc: '下鴨神社', arr_loc: '河合神社', note: '' },

                   { id: 'd4_6', time: '12:35', activity: '河合神社', details: '參觀15min', transport: '停留', duration: '15min', type: '景點', dep_time: '12:35', arr_time: '12:50', dep_loc: '河合神社', arr_loc: '河合神社', note: '機動行程看時間刪減 / 祈求美麗的神社' },

                   { id: 'd4_7_walk', time: '12:50', activity: '步行 (往鴨川三角洲)', details: '步行8min到鴨川三角洲', transport: '步行', duration: '8min', type: '交通', dep_time: '12:50', arr_time: '12:58', dep_loc: '河合神社', arr_loc: '鴨川三角洲', note: '' },

                   { id: 'd4_7', time: '13:00', activity: '鴨川三角洲', details: '散步30min', transport: '停留', duration: '30min', type: '景點', dep_time: '13:00', arr_time: '13:30', dep_loc: '鴨川三角洲', arr_loc: '鴨川三角洲', note: '跳烏龜石 / 適合放鬆' },

                   // --- 移動回酒店取行李 ---
                   { id: 'd4_8_walk', time: '13:30', activity: '步行 (往京阪本線)', details: '步行6min到京阪本線', transport: '步行', duration: '6min', type: '交通', dep_time: '13:30', arr_time: '13:36', dep_loc: '鴨川三角洲', arr_loc: '出柳町', note: '' },
                   
                   { id: 'd4_8_wait', time: '13:36', activity: '步行後等候 京阪本線', details: '等候緩衝時間 (預留 3 分鐘)', transport: '等待', duration: '3min', type: '彈性', dep_time: '13:36', arr_time: '13:39', dep_loc: '出柳町', arr_loc: '出柳町', note: '等待京阪本線13:39 班次' },

                   { id: 'd4_8', time: '13:39', activity: '京阪本線 準急行 (往淀屋橋)', details: '出柳町13:39 三條13:43', transport: '電車', duration: '4min', type: '交通', dep_time: '13:39', arr_time: '13:43', dep_loc: '出柳町', arr_loc: '三條', note: '' },

                   { id: 'd4_9_walk', time: '13:43', activity: '步行轉乘 (往地鐵東西線)', details: '步行6min轉乘', transport: '步行', duration: '6min', type: '交通', dep_time: '13:43', arr_time: '13:49', dep_loc: '三條', arr_loc: '三條京阪', note: '' },
                   
                   { id: 'd4_9_wait', time: '13:49', activity: '步行後等候 地鐵東西線', details: '等候緩衝時間 (預留 10 分鐘)', transport: '等待', duration: '10min', type: '彈性', dep_time: '13:49', arr_time: '13:59', dep_loc: '三條京阪', arr_loc: '三條京阪', note: '等待地鐵東西線13:59 班次' },

                   { id: 'd4_10', time: '13:59', activity: '地鐵東西線 (往太秦天神川)', details: '三條京阪13:59 烏丸御池14:02', transport: '地鐵', duration: '3min', type: '交通', dep_time: '13:59', arr_time: '14:02', dep_loc: '三條京阪', arr_loc: '烏丸御池', note: '' },

                   { id: 'd4_11', time: '14:02', activity: '步行 (往酒店拿行李)', details: '步行5min到京都御池insomnia酒店', transport: '步行', duration: '8min', type: '交通', dep_time: '14:02', arr_time: '14:10', dep_loc: '烏丸御池', arr_loc: '酒店', note: '' },

                   { id: 'd4_12', time: '14:10', activity: '京都御池insomnia酒店', details: '領取寄放的行李並準備前往大阪', transport: '住宿', duration: '10min', type: '住宿', dep_time: '14:10', arr_time: '14:20', dep_loc: '酒店', arr_loc: '酒店', note: '準備移動到大阪' },

                   // --- 移動到大阪 ---
                   { id: 'd4_13_walk', time: '14:20', activity: '步行 (往地鐵烏丸線)', details: '步行10min到地鐵烏丸線', transport: '步行', duration: '10min', type: '交通', dep_time: '14:20', arr_time: '14:30', dep_loc: '酒店', arr_loc: '烏丸御池', note: '' },
                   
                   { id: 'd4_13_wait', time: '14:30', activity: '步行後等候 地鐵烏丸線', details: '等候緩衝時間 (預留 6 分鐘)', transport: '等待', duration: '6min', type: '彈性', dep_time: '14:30', arr_time: '14:36', dep_loc: '烏丸御池', arr_loc: '烏丸御池', note: '等待地鐵烏丸線14:36 班次' },

                   { id: 'd4_13', time: '14:36', activity: '地鐵烏丸線 (往竹田)', details: '烏丸御池14:36 京都14:41', transport: '地鐵', duration: '5min', type: '交通', dep_time: '14:36', arr_time: '14:41', dep_loc: '烏丸御池', arr_loc: '京都', note: '' },

                   { id: 'd4_14_wait', time: '14:41', activity: '轉乘及等候 JR京都線', details: '抵達京都站，等候 15:00 新快速列車', transport: '等待', duration: '19min', type: '彈性', dep_time: '14:41', arr_time: '15:00', dep_loc: '京都', arr_loc: '京都', note: '轉乘JR京都線15:00班次' },

                   { id: 'd4_14', time: '15:00', activity: 'JR京都線 新快速 (往姬路經湖西線)', details: '京都15:00 大阪15:28\n(往姬路經湖西線)', transport: 'JR', duration: '28min', type: '交通', dep_time: '15:00', arr_time: '15:28', dep_loc: '京都', arr_loc: '大阪', note: '新快速' },

                   { id: 'd4_15_walk', time: '15:28', activity: '步行轉乘 (往地鐵御堂筋線)', details: '步行10min到地鐵御堂筋線\n(人多則搭計程車)', transport: '步行', duration: '10min', type: '交通', dep_time: '15:28', arr_time: '15:38', dep_loc: '大阪', arr_loc: '梅田', note: '' },
                   
                   { id: 'd4_15_wait', time: '15:38', activity: '步行後等候 地鐵御堂筋線', details: '等候緩衝時間 (預留 10 分鐘)', transport: '等待', duration: '10min', type: '彈性', dep_time: '15:38', arr_time: '15:48', dep_loc: '梅田', arr_loc: '梅田', note: '等待地鐵御堂筋線15:48 班次<br>人多則搭計程車' },

                   { id: 'd4_16', time: '15:48', activity: '地鐵御堂筋線 (往中百舌鳥)', details: '梅田15:48 本町15:53', transport: '地鐵', duration: '5min', type: '交通', dep_time: '15:48', arr_time: '15:53', dep_loc: '梅田', arr_loc: '本町', note: '' },

                   { id: 'd4_17_wait', time: '15:53', activity: '轉乘及等候 地鐵中央線', details: '本町站轉乘 (OR 步行15min)', transport: '等待', duration: '8min', type: '彈性', dep_time: '15:53', arr_time: '16:01', dep_loc: '本町', arr_loc: '本町', note: '轉乘地鐵中央線16:01班次<br>OR步行15min' },

                   { id: 'd4_18', time: '16:01', activity: '地鐵中央線 (往學研奈良登美丘)', details: '本町16:01 堺筋本町16:02', transport: '地鐵', duration: '1min', type: '交通', dep_time: '16:01', arr_time: '16:02', dep_loc: '本町', arr_loc: '堺筋本町', note: '' },

                   { id: 'd4_19', time: '16:02', activity: '步行 (往酒店)', details: '步行5min到大阪本町都城市酒店', transport: '步行', duration: '8min', type: '交通', dep_time: '16:02', arr_time: '16:10', dep_loc: '堺筋本町', arr_loc: '酒店', note: '' },

                   // --- 大阪酒店與晚餐 ---
                   { id: 'd4_20', time: '16:10', activity: '大阪本町都城市酒店', details: 'Check-in 休息\n(預計 17:40 出發前往晚餐)', transport: '住宿', duration: '1hr 30min', type: '住宿', dep_time: '16:10', arr_time: '17:40', dep_loc: '酒店', arr_loc: '出發', note: '休息片刻' },

                   { id: 'd4_21_walk', time: '17:40', activity: '步行 (往敘敘苑)', details: '步行20min到敘敘苑', transport: '步行', duration: '20min', type: '交通', dep_time: '17:40', arr_time: '18:00', dep_loc: '酒店', arr_loc: '敘敘苑', note: '' },

                   { id: 'd4_21', time: '18:00', activity: '敘敘苑 大丸心齋橋店', details: '晚餐2hr', transport: '停留', duration: '2hr', type: '吃飯', dep_time: '18:00', arr_time: '20:00', dep_loc: '敘敘苑', arr_loc: '敘敘苑', note: '訂位18:00' },

                   { id: 'd4_22_walk', time: '20:00', activity: '步行 (回酒店)', details: '步行20min到大阪本町都城市酒店', transport: '步行', duration: '20min', type: '交通', dep_time: '20:00', arr_time: '20:20', dep_loc: '敘敘苑', arr_loc: '酒店', note: '' },

                   { id: 'd4_22', time: '20:20', activity: '大阪本町都城市酒店', details: '回到酒店休息/自由活動', transport: '住宿', duration: 'N/A', type: '住宿', dep_time: '20:20', arr_time: 'N/A', dep_loc: '酒店', arr_loc: 'N/A', note: '結束 Day 4' },
               ],
               "Day5": [
                   { id: 'd5_0', time: '07:30', activity: '大阪本町都城市酒店', details: '早上從酒店出發', transport: '住宿', duration: '0min', type: '住宿', dep_time: '07:30', arr_time: '07:30', dep_loc: '酒店', arr_loc: '酒店', note: '開始 Day 5' },
                   // V22 修正：步行 15min 到地鐵站 (07:30 -> 07:45)
                   { id: 'd5_0_walk', time: '07:30', activity: '步行 (往地鐵御堂筋線)', details: '步行15min到地鐵御堂筋線', transport: '步行', duration: '15min', type: '交通', dep_time: '07:30', arr_time: '07:45', dep_loc: '酒店', arr_loc: '地鐵站', note: '' },
                   // V22 修正：等待緩衝 4min (07:45 -> 07:49)
                   { id: 'd5_0_wait', time: '07:45', activity: '步行後等候 地鐵御堂筋線', details: '等候緩衝時間 (預留 4 分鐘)', transport: '等待', duration: '4min', type: '彈性', dep_time: '07:45', arr_time: '07:49', dep_loc: '地鐵站', arr_loc: '地鐵站', note: '等待地鐵御堂筋線07:49班次' },
                   { id: 'd5_1', time: '07:49', activity: '地鐵御堂筋線/北大阪急行線 (往箕面萱野)', details: '本町07:49 江坂箕面萱野08:20', transport: '地鐵', duration: '31min', type: '交通', dep_time: '07:49', arr_time: '08:20', dep_loc: '本町', arr_loc: '箕面萱野', note: '搭乘御堂筋線至江坂接續北大阪急行線' },
                   // V21 修正：將步行與等待時間分離
                   { id: 'd5_2_walk', time: '08:20', activity: '步行 (轉乘公車)', details: '步行10min到公車站', transport: '步行', duration: '10min', type: '交通', dep_time: '08:20', arr_time: '08:30', dep_loc: '箕面萱野', arr_loc: '公車站', note: '' },
                   { id: 'd5_2_wait', time: '08:30', activity: '步行後等候 30 Bus (往勝尾寺)', details: '等候緩衝時間 (等候 09:00 班次)', transport: '等待', duration: '30min', type: '彈性', dep_time: '08:30', arr_time: '09:00', dep_loc: '公車站', arr_loc: '公車站', note: '8號乘車處等待30 Bus 09:00班次' },
                   { id: 'd5_2', time: '09:00', activity: '30 Bus (往勝尾寺)', details: '箕面萱野09:00 勝尾寺09:22', transport: '公車', duration: '22min', type: '交通', dep_time: '09:00', arr_time: '09:22', dep_loc: '箕面萱野', arr_loc: '勝尾寺', note: '8號乘車處' },
                   { id: 'd5_3', time: '09:25', activity: '勝尾寺', details: '參觀 2hr \n30 bus (往箕面萱野站)', transport: '停留', duration: '2hr ', type: '景點', dep_time: '09:25', arr_time: '11:25', dep_loc: '勝尾寺', arr_loc: '勝尾寺', note: '達摩寺 / 滿滿的勝利達摩' },
                   { id: 'd5_2_wait', time: '11:25', activity: '步行後等候 30 Bus (往箕面萱野站)', details: '等候緩衝時間 (等候 11:50 班次)', transport: '等待', duration: '25min', type: '彈性', dep_time: '11:25', arr_time: '11:50', dep_loc: '公車站', arr_loc: '公車站', note: '等待30 Bus 11:50班次' },
                   { id: 'd5_4', time: '11:50', activity: '30 Bus (往箕面萱野)', details: '勝尾寺11:50 箕面萱野12:11', transport: '公車', duration: '21min', type: '交通', dep_time: '11:50', arr_time: '12:11', dep_loc: '勝尾寺', arr_loc: '箕面萱野', note: '' },
                   // V21 修正：將步行與等待時間分離
                   { id: 'd5_5_walk', time: '12:11', activity: '步行 (轉乘地鐵)', details: '步行10min到地鐵北大阪急行線', transport: '步行', duration: '10min', type: '交通', dep_time: '12:11', arr_time: '12:21', dep_loc: '箕面萱野', arr_loc: '箕面萱野站', note: '' },
                   { id: 'd5_5_walk_wait', time: '12:21', activity: '步行後等候 地鐵北大阪急行線', details: '等候緩衝時間 (預留 6 分鐘)', transport: '等待', duration: '6min', type: '彈性', dep_time: '12:21', arr_time: '12:27', dep_loc: '箕面萱野站', arr_loc: '箕面萱野站', note: '等待北大阪急行線12:27班次' },
                   { id: 'd5_5', time: '12:27', activity: '地鐵北大阪急行線/御堂筋線 (往中百舌鳥)', details: '箕面萱野12:27 江坂 本町12:57', transport: '地鐵', duration: '30min', type: '交通', dep_time: '12:27', arr_time: '12:57', dep_loc: '箕面萱野', arr_loc: '本町', note: '搭乘北大阪急行線至江坂接續御堂筋線' },
                   // V20 新增：等待地鐵中央線 (4min)
                   { id: 'd5_5_wait', time: '12:57', activity: '轉乘及等候 地鐵中央線', details: '抵達本町，等候 13:01 的地鐵中央線', transport: '等待', duration: '4min', type: '彈性', dep_time: '12:57', arr_time: '13:01', dep_loc: '本町', arr_loc: '本町', note: '轉乘地鐵中央線13:01班次' },
                   { id: 'd5_6', time: '13:01', activity: '地鐵中央線 (往生駒)', details: '本町13:01 谷町四丁目13:04', transport: '地鐵', duration: '3min', type: '交通', dep_time: '13:01', arr_time: '13:04', dep_loc: '本町', arr_loc: '谷町四丁目', note: '' },
                   { id: 'd5_6_walk', time: '13:04', activity: '步行 (往咖喱店)', details: '步行6min到咖喱店', transport: '步行', duration: '6min', type: '交通', dep_time: '13:04', arr_time: '13:10', dep_loc: '谷町四丁目', arr_loc: '咖喱店', note: '' },
                   { id: 'd5_7', time: '13:10', activity: '呑めるカレーハウス インディー内本町店', details: '午餐1hr ', transport: '停留', duration: '1hr ', type: '吃飯', dep_time: '13:10', arr_time: '14:10', dep_loc: '咖喱店', arr_loc: '咖喱店', note: '日式咖哩' },
                   { id: 'd5_8_walk', time: '14:10', activity: '步行 (往大阪城)', details: '步行20min到大阪城', transport: '步行', duration: '20min', type: '交通', dep_time: '14:10', arr_time: '14:30', dep_loc: '咖喱店', arr_loc: '大阪城', note: '' },
                   { id: 'd5_8', time: '14:30', activity: '大阪城', details: '參觀2hr ', transport: '停留', duration: '2hr ', type: '景點', dep_time: '14:30', arr_time: '16:30', dep_loc: '大阪城', arr_loc: '大阪城', note: '豐臣秀吉的城堡' },
                   { id: 'd5_9_walk', time: '16:30', activity: '步行 (往地鐵谷町線)', details: '步行20min到地鐵谷町線', transport: '步行', duration: '20min', type: '交通', dep_time: '16:30', arr_time: '16:50', dep_loc: '大阪城', arr_loc: '谷町四丁目', note: '' },
                   { id: 'd5_9_wait', time: '16:50', activity: '步行後等候 地鐵谷町線', details: '等候緩衝時間 (預留 10 分鐘)', transport: '等待', duration: '10min', type: '彈性', dep_time: '16:50', arr_time: '17:00', dep_loc: '谷町四丁目', arr_loc: '谷町四丁目', note: '等待地鐵谷町線17:00班次' },
                   { id: 'd5_9', time: '17:00', activity: '地鐵谷町線 (往喜連瓜破)', details: '谷町四丁目17:00 天王寺17:07', transport: '地鐵', duration: '7min', type: '交通', dep_time: '17:00', arr_time: '17:07', dep_loc: '谷町四丁目', arr_loc: '天王寺', note: '' },
                   { id: 'd5_10_walk', time: '17:07', activity: '步行 (往阿倍野HARUKAS)', details: '步行3min到阿倍野HARUKAS', transport: '步行', duration: '3min', type: '交通', dep_time: '17:07', arr_time: '17:10', dep_loc: '天王寺', arr_loc: '阿倍野HARUKAS', note: '' },
                   { id: 'd5_10', time: '17:10', activity: '阿倍野HARUKAS', details: '看夜景1.5hr', transport: '停留', duration: '1hr 30min', type: '景點', dep_time: '17:10', arr_time: '18:40', dep_loc: '阿倍野HARUKAS', arr_loc: '阿倍野HARUKAS', note: '大阪最高的摩天大樓' },
                   { id: 'd5_11_walk', time: '18:40', activity: '步行 (往地鐵谷町線)', details: '步行3min到地鐵谷町線', transport: '步行', duration: '3min', type: '交通', dep_time: '18:40', arr_time: '18:43', dep_loc: '阿倍野HARUKAS', arr_loc: '天王寺', note: '' },
                   { id: 'd5_11_wait', time: '18:43', activity: '步行後等候 地鐵谷町線', details: '等候緩衝時間 (預留 1 分鐘)', transport: '等待', duration: '1min', type: '彈性', dep_time: '18:43', arr_time: '18:44', dep_loc: '天王寺', arr_loc: '天王寺', note: '等待地鐵谷町線18:44班次' },
                   { id: 'd5_11', time: '18:44', activity: '地鐵谷町線 (往都島)', details: '天王寺18:44 谷町九丁目18:48', transport: '地鐵', duration: '4min', type: '交通', dep_time: '18:44', arr_time: '18:48', dep_loc: '天王寺', arr_loc: '谷町九丁目', note: '' },
                   { id: 'd5_12_wait', time: '18:48', activity: '轉乘及等候 地鐵千日前線', details: '等候緩衝時間 (預留 5 分鐘)', transport: '等待', duration: '5min', type: '彈性', dep_time: '18:48', arr_time: '18:53', dep_loc: '地鐵站', arr_loc: '地鐵站', note: '轉乘地鐵千日前線18:53班次' },
                   { id: 'd5_12', time: '18:53', activity: '地鐵千日前線 (往野田阪神)', details: '谷町九丁目18:53 日本橋18:54', transport: '地鐵', duration: '1min', type: '交通', dep_time: '18:53', arr_time: '18:54', dep_loc: '谷町九丁目', arr_loc: '日本橋', note: '' },
                   { id: 'd5_13', time: '18:54', activity: '步行 (往牛舌檸檬)', details: '步行6min到牛舌檸檬', transport: '步行', duration: '6min', type: '交通', dep_time: '18:54', arr_time: '19:00', dep_loc: '日本橋', arr_loc: '牛舌檸檬', note: '' },
                   { id: 'd5_14', time: '19:00', activity: '新宿焼肉 牛たんの檸檬大阪本店', details: '晚餐1hr', transport: '停留', duration: '1hr ', type: '吃飯', dep_time: '19:00', arr_time: '20:00', dep_loc: '牛舌檸檬', arr_loc: '牛舌檸檬', note: '預計用餐1小時' },
                   { id: 'd5_15_walk', time: '20:00', activity: '步行 (往地鐵堺筋線)', details: '步行5min到地鐵堺筋線', transport: '步行', duration: '5min', type: '交通', dep_time: '20:00', arr_time: '20:05', dep_loc: '牛舌檸檬', arr_loc: '日本橋', note: '' },
                   { id: 'd5_15_wait', time: '20:05', activity: '步行後等候 地鐵堺筋線', details: '等候緩衝時間 (預留 6 分鐘)', transport: '等待', duration: '6min', type: '彈性', dep_time: '20:05', arr_time: '20:11', dep_loc: '日本橋', arr_loc: '日本橋', note: '等待地鐵堺筋線20:11班次' },
                   { id: 'd5_15', time: '20:11', activity: '地鐵堺筋線 (往北千里)', details: '日本橋20:11 堺筋本町20:14', transport: '地鐵', duration: '3min', type: '交通', dep_time: '20:11', arr_time: '20:14', dep_loc: '日本橋', arr_loc: '堺筋本町', note: '' },
                   { id: 'd5_16', time: '20:14', activity: '步行 (回酒店)', details: '步行6min到大阪本町都城市酒店', transport: '步行', duration: '6min', type: '交通', dep_time: '20:14', arr_time: '20:20', dep_loc: '堺筋本町', arr_loc: '酒店', note: '' },
                   { id: 'd5_17', time: '20:20', activity: '大阪本町都城市酒店', details: '回到酒店休息/自由活動', transport: '住宿', duration: 'N/A', type: '住宿', dep_time: '20:20', arr_time: 'N/A', dep_loc: '酒店', arr_loc: 'N/A', note: '結束 Day 5' },
               ],
               "Day6": [
                   { id: 'd6_0', time: '09:40', activity: '大阪本町都城市酒店', details: '早上從酒店出發', transport: '住宿', duration: '0min', type: '住宿', dep_time: '09:40', arr_time: '09:40', dep_loc: '酒店', arr_loc: '酒店', note: '開始 Day 6' },
                   // V22 修正：步行 20min 到心齋橋商店街 (09:40 -> 10:00)
                   { id: 'd6_1_walk', time: '09:40', activity: '步行 (往心齋橋筋商店街)', details: '步行20min到心齋橋', transport: '步行', duration: '20min', type: '交通', dep_time: '09:40', arr_time: '10:00', dep_loc: '酒店', arr_loc: '心齋橋', note: '' },
                   { id: 'd6_1', time: '10:00', activity: '心齋橋筋商店街 (上午)', details: '營業時間11:00\n閒晃1hr', transport: '停留', duration: '1hr', type: '逛街', dep_time: '10:00', arr_time: '11:00', dep_loc: '心齋橋筋商店街', arr_loc: '心齋橋筋商店街', note: '部分店家 11:00才營業' },
                   { id: 'd6_2', time: '11:00', activity: '味乃家御好燒 (午餐)', details: '午餐1hr', transport: '停留', duration: '1hr', type: '吃飯', dep_time: '11:00', arr_time: '12:00', dep_loc: '味乃家御好燒', arr_loc: '味乃家御好燒', note: '必吃大阪燒 (或大阪燒千房)' },
                   { id: 'd6_3', time: '12:00', activity: '心齋橋筋商店街 (下午)', details: '打烊時間20:00\n逛街7hr', transport: '停留', duration: '7hr', type: '逛街', dep_time: '12:00', arr_time: '19:00', dep_loc: '心齋橋筋商店街', arr_loc: '心齋橋筋商店街', note: '瘋狂購物時間' },
                   { id: 'd6_4', time: '19:00', activity: '晚餐 (道頓崛美食)', details: '晚餐1hr\n路邊攤隨便吃', transport: '停留', duration: '1hr', type: '吃飯', dep_time: '19:00', arr_time: '20:00', dep_loc: '道頓崛', arr_loc: '道頓崛', note: '嘗試道頓堀周邊美食' },
                   { id: 'd6_5', time: '20:00', activity: '步行 (回酒店)', details: '步行20min回大阪本町都城市酒店', transport: '步行', duration: '20min', type: '交通', dep_time: '20:00', arr_time: '20:20', dep_loc: '心齋橋', arr_loc: '酒店', note: '' },
                   { id: 'd6_6', time: '20:20', activity: '大阪本町都城市酒店', details: '回到酒店休息/自由活動', transport: '住宿', duration: 'N/A', type: '住宿', dep_time: '20:20', arr_time: 'N/A', dep_loc: '酒店', arr_loc: 'N/A', note: '結束 Day 6' },
               ],
               "Day7": [
                   // V23 修正：Check-out 結束時間調整為 07:50
                   { id: 'd7_0', time: '07:50', activity: '大阪本町都城市酒店', details: 'Check-out辦理退房手續並準備前往機場', transport: '住宿', duration: '0min', type: '住宿', dep_time: '07:50', arr_time: '07:50', dep_loc: '酒店', arr_loc: '酒店', note: '開始 Day 7 ' },
                   // V23 修正：步行時間改為 07:50 -> 07:55
                   { id: 'd7_1_walk', time: '07:50', activity: '步行 (往地鐵中央線)', details: '步行5min到地鐵中央線', transport: '步行', duration: '5min', type: '交通', dep_time: '07:50', arr_time: '07:55', dep_loc: '酒店', arr_loc: '堺筋本町', note: '' },
                   // V23 修正：等待緩衝時間改為 07:55 -> 08:13 (18min)
                   { id: 'd7_1_wait', time: '07:55', activity: '步行後等候 地鐵中央線 ', details: '等候緩衝時間 (預留 18 分鐘)', transport: '等待', duration: '18min', type: '彈性', dep_time: '07:55', arr_time: '08:13', dep_loc: '堺筋本町', arr_loc: '堺筋本町', note: '等待地鐵中央線08:13班次<br> OR搭乘計程車前往南海難波' },
                   { id: 'd7_1', time: '08:13', activity: '地鐵中央線 (往夢洲)', details: '堺筋本町08:13 本町08:14', transport: '地鐵', duration: '1min', type: '交通', dep_time: '08:13', arr_time: '08:14', dep_loc: '堺筋本町', arr_loc: '本町', note: '' },
                   { id: 'd7_2_wait', time: '08:14', activity: '轉乘及等候 地鐵御堂筋線', details: '抵達本町，等候 08:14 的地鐵御堂筋線', transport: '等待', duration: '5min', type: '彈性', dep_time: '08:14', arr_time: '08:19', dep_loc: '本町', arr_loc: '本町', note: '轉乘地鐵御堂筋線08:19班次' },
                   { id: 'd7_2', time: '08:19', activity: '地鐵御堂筋線 (往中百舌鳥)', details: '本町08:19 難波08:22', transport: '地鐵', duration: '3min', type: '交通', dep_time: '08:19', arr_time: '08:22', dep_loc: '本町', arr_loc: '難波', note: '' },
                   // V21 修正：將步行與等候時間分離
                   { id: 'd7_3_walk', time: '08:22', activity: '步行轉乘 (往南海難波)', details: '步行10min到南海難波站', transport: '步行', duration: '10min', type: '交通', dep_time: '08:22', arr_time: '08:32', dep_loc: '難波地鐵站', arr_loc: '南海難波', note: '' },
                   { id: 'd7_3_wait', time: '08:32', activity: '轉乘及等候 南海電鐵', details: '抵達南海難波，等候 09:00 班次', transport: '等待', duration: '28min', type: '彈性', dep_time: '08:32', arr_time: '09:00', dep_loc: '南海難波', arr_loc: '南海難波', note: '等待南海特急09:00班次 （搭乘計程車提早到 則搭乘08:30班次）' },
                   { id: 'd7_4', time: '09:00', activity: '南海特急 (往關西機場)', details: '南海難波09:00 關西機場09:38', transport: '電車', duration: '38min', type: '交通', dep_time: '09:00', arr_time: '09:38', dep_loc: '南海難波', arr_loc: '關西機場', note: 'KLOOK購買南海電鐵特急車票 線上劃位' },
                   { id: 'd7_5', time: '09:40', activity: '關西國際機場T1 報到', details: '中華航空CI0153\n預計 14:30 關西起飛，需提前報到', transport: '停留', duration: '4hr 50min', type: '彈性', dep_time: '09:40', arr_time: '14:30', dep_loc: '機場T1', arr_loc: '登機口', note: '國際航班請預留充足時間報到/安檢' },
                   { id: 'd7_6', time: '14:30', activity: '中華航空CI0153 (飛往桃園)', details: '關西14:30 桃園16:45', transport: '飛機', duration: '2hr 15min', type: '交通', dep_time: '14:30', arr_time: '16:45', dep_loc: '關西', arr_loc: '桃園T2', note: '回程班機' },
                   { id: 'd7_7', time: '16:45', activity: '桃園國際機場T2 入境', details: '約停留2hr出關', transport: '停留', duration: '15min', type: '彈性', dep_time: '16:45', arr_time: '18:45', dep_loc: '桃園T2', arr_loc: '機捷', note: '' },
                   { id: 'd7_8', time: '18:45', activity: '機捷 (往高鐵桃園)', details: '機場第二航廈N/A ➡ A18高鐵桃園N/A', transport: '機捷', duration: '21min', type: '交通', dep_time: 'N/A', arr_time: 'N/A', dep_loc: '機場T2', arr_loc: 'A18高鐵桃園', note: '' },
                   { id: 'd7_9', time: 'N/A', activity: '台灣高鐵 (往台中)', details: '高鐵 桃園➡ 台中', transport: '高鐵', duration: '40min', type: '交通', dep_time: 'N/A', arr_time: 'N/A', dep_loc: '高鐵桃園站', arr_loc: '高鐵台中站', note: '高鐵票需另行購買' },
                   { id: 'd7_10', time: 'N/A', activity: '溫暖的家 / End', details: '旅程結束', transport: '停留', duration: 'N/A', type: '彈性', dep_time: 'N/A', arr_time: 'N/A', dep_loc: '高鐵台中站', arr_loc: '家', note: '結束旅程' },
               ],
           };
       };

       const DATE_MAP = {
           'Day1': '01/11(日)', 'Day2': '01/12(一)', 'Day3': '01/13(二)', 'Day4': '01/14(三)',
           'Day5': '01/15(四)', 'Day6': '01/16(五)', 'Day7': '01/17(六)'
       };
       const DAYS = ['Day1', 'Day2', 'Day3', 'Day4', 'Day5', 'Day6', 'Day7'];
       
       // 插圖配置 (使用即時生成圖像)
       const ILLUSTRATIONS = {
           'Cover': 'https://image.pollinations.ai/prompt/Kyoto%20Osaka%20luxury%20gold%20travel%20poster%20collage%20winter%20snow%20temple?width=800&height=1000&nologo=true',
           'Day1': 'https://image.pollinations.ai/prompt/Kyoto%20Tower%20night%20view%20winter%20snow%20sketch%20style?width=800&height=400&nologo=true',
           'Day2': 'https://image.pollinations.ai/prompt/Arashiyama%20Bamboo%20Grove%20winter%20snow%20path%20illustration?width=800&height=400&nologo=true',
           'Day3': 'https://image.pollinations.ai/prompt/Kiyomizu-dera%20temple%20winter%20snow%20red%20pagoda%20sketch?width=800&height=400&nologo=true',
           'Day4': 'https://image.pollinations.ai/prompt/Kinkakuji%20Golden%20Pavilion%20winter%20snow%20pond%20reflection%20art?width=800&height=400&nologo=true',
           'Day5': 'https://image.pollinations.ai/prompt/Osaka%20Castle%20winter%20snow%20grand%20illustration?width=800&height=400&nologo=true',
           'Day6': 'https://image.pollinations.ai/prompt/Shinsaibashi%20Osaka%20shopping%20street%20neon%20lights%20crowd%20sketch?width=800&height=400&nologo=true',
           'Day7': 'https://image.pollinations.ai/prompt/Kansai%20International%20Airport%20plane%20takeoff%20sunset%20art?width=800&height=400&nologo=true'
       };

       const ILLUSTRATION_CAPTIONS = {
           'Day1': '京都塔夜景・Kyoto Tower',
           'Day2': '嵐山竹林小徑・Arashiyama Bamboo Grove',
           'Day3': '清水寺與伏見稻荷・Kiyomizu-dera',
           'Day4': '金閣寺・Kinkaku-ji',
           'Day5': '大阪城天守閣・Osaka Castle',
           'Day6': '心齋橋商店街・Shinsaibashi',
           'Day7': '關西機場・Kansai Airport'
       };

       // --- 2. 應用邏輯 ---

       let currentPageIndex = 0;
       const book = document.getElementById('book');
       const totalPages = DAYS.length + 2; // Cover + 7 Days + Back Cover

       function createTimelineHTML(day) {
           const data = window.getRefinedItineraryData()[day];
           if (!data) return '<div class="text-center p-4">無行程資料</div>';

           return data.map(item => {
               let typeClass = 'type-spot';
               let icon = 'fa-map-marker-alt';
               
               if (item.type === '交通' || item.transport.includes('步行') || item.transport === '等待') {
                   typeClass = 'type-transit';
                   if(item.transport.includes('JR')) icon = 'fa-train';
                   else if(item.transport.includes('地鐵')) icon = 'fa-subway';
                   else if(item.transport.includes('公車') || item.transport.includes('客運')) icon = 'fa-bus';
                   else if(item.transport.includes('步行')) icon = 'fa-walking';
                   else if(item.transport.includes('飛機')) icon = 'fa-plane';
                   else icon = 'fa-exchange-alt';
               } else if (item.type === '吃飯') {
                   typeClass = 'type-food';
                   icon = 'fa-utensils';
               } else if (item.type === '住宿') {
                   typeClass = 'type-hotel';
                   icon = 'fa-bed';
               }

               return `
               <div class="timeline-item ${typeClass}">
                   <div class="time-badge">${item.time}</div>
                   <div class="timeline-dot"></div>
                   <div class="timeline-content">
                       <div class="flex justify-between items-start mb-1">
                           <h3 class="font-bold text-slate-800 text-lg">${item.activity}</h3>
                           <i class="fas ${icon} text-slate-400"></i>
                       </div>
                       <div class="text-xs font-bold text-slate-500 mb-2 bg-slate-100 inline-block px-2 py-1 rounded">
                           ${item.transport} ${item.duration !== 'N/A' ? `• ${item.duration}` : ''}
                       </div>
                       <p class="text-sm text-slate-600 leading-relaxed whitespace-pre-line">${item.details}</p>
                       ${item.note ? `<div class="mt-2 text-xs text-amber-600 bg-amber-50 p-2 rounded border border-amber-100"><i class="fas fa-info-circle mr-1"></i> ${item.note}</div>` : ''}
                   </div>
               </div>
               `;
           }).join('');
       }

       function renderBook() {
           // 1. Cover Page
           const coverDiv = document.createElement('div');
           coverDiv.className = 'page';
           coverDiv.style.zIndex = totalPages;
           coverDiv.innerHTML = `
               <div class="page-front cover-page">
                   <div class="text-center p-8 relative z-10">
                       <div class="text-blue-200 tracking-[0.5em] text-sm mb-4 font-bold">WINTER EDITION 2026</div>
                       <h1 class="text-6xl md:text-8xl font-black mb-2 gold-text leading-tight">KYOTO<br>OSAKA</h1>
                       <div class="h-1 w-24 bg-gradient-to-r from-transparent via-[#bf953f] to-transparent mx-auto my-6"></div>
                       <div class="text-xl text-slate-300 font-light tracking-widest font-serif">WINTER TRAVEL GUIDE</div>
                       <div class="mt-12 text-sm text-slate-400 border border-slate-600 px-6 py-2 rounded-full inline-block">JAN 11 - JAN 17</div>
                   </div>
                   <img src="${ILLUSTRATIONS['Cover']}" class="absolute bottom-0 w-full h-1/2 object-cover opacity-40 mix-blend-overlay pointer-events-none" alt="Cover Art">
                   <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-30 pointer-events-none"></div>
               </div>
               <div class="page-back"></div>
           `;
           book.appendChild(coverDiv);

           // 2. Day Pages
           DAYS.forEach((day, index) => {
               const pageDiv = document.createElement('div');
               pageDiv.className = 'page';
               // z-index 遞減，確保堆疊正確
               pageDiv.style.zIndex = totalPages - 1 - index;
               
               const dateStr = DATE_MAP[day];
               const contentHTML = createTimelineHTML(day);
               
               pageDiv.innerHTML = `
                   <div class="page-front inner-layout">
                       <div class="bookmark"></div>
                       <div class="page-header">
                           <div class="japanese-pattern"></div>
                           <div class="flex justify-between items-end relative z-10">
                               <div>
                                   <div class="text-4xl font-black text-slate-800 font-serif">${day}</div>
                                   <div class="text-lg text-slate-500 font-medium mt-1">${dateStr}</div>
                               </div>
                               <div class="text-right">
                                   <div class="text-xs text-slate-400 uppercase tracking-wider">Kyoto / Osaka</div>
                                   <div class="text-2xl text-blue-900"><i class="fas fa-snowflake"></i></div>
                               </div>
                           </div>
                       </div>
                       
                       <div class="timeline-container">
                           <img src="${ILLUSTRATIONS[day]}" class="day-illustration" alt="${day} Illustration">
                           <div class="illustration-caption">${ILLUSTRATION_CAPTIONS[day]}</div>
                           
                           <div class="relative">
                               <div class="timeline-line"></div>
                               ${contentHTML}
                           </div>
                       </div>

                       <div class="page-number">- ${index + 1} -</div>
                   </div>
                   <div class="page-back"></div>
               `;
               book.appendChild(pageDiv);
           });

           // 3. Back Cover
           const backCover = document.createElement('div');
           backCover.className = 'page';
           backCover.style.zIndex = 1;
           backCover.innerHTML = `
               <div class="page-front bg-slate-100 flex items-center justify-center">
                   <div class="text-center">
                       <h2 class="text-3xl font-serif text-slate-400 mb-4">THE END</h2>
                       <p class="text-slate-500">Have a nice trip!</p>
                       <div class="mt-8 text-slate-300 text-sm">2026 KYOTO OSAKA GOGO</div>
                   </div>
               </div>
           `;
           book.appendChild(backCover);
       }

       function updateZIndexes() {
           const pages = document.querySelectorAll('.page');
           pages.forEach((page, index) => {
               // 動態調整 z-index 以處理層疊關係
               if (index < currentPageIndex) {
                   page.style.zIndex = index + 1; // 已翻過的頁面，堆疊順序反轉
               } else {
                   page.style.zIndex = totalPages - index; // 未翻過的頁面，正常堆疊
               }
           });
           
           // 更新按鈕狀態
           document.getElementById('prevBtn').disabled = currentPageIndex === 0;
           document.getElementById('nextBtn').disabled = currentPageIndex === totalPages - 1;
       }

       function flipNext() {
           if (currentPageIndex < totalPages - 1) {
               const pages = document.querySelectorAll('.page');
               pages[currentPageIndex].classList.add('flipped');
               currentPageIndex++;
               updateZIndexes();
           }
       }

       function flipPrev() {
           if (currentPageIndex > 0) {
               currentPageIndex--;
               const pages = document.querySelectorAll('.page');
               pages[currentPageIndex].classList.remove('flipped');
               updateZIndexes();
           }
       }

       // --- 3. 雪花特效 (Canvas) ---
       function initSnow() {
           const canvas = document.getElementById('snow-canvas');
           const ctx = canvas.getContext('2d');
           let width = canvas.width = window.innerWidth;
           let height = canvas.height = window.innerHeight;

           const snowflakes = [];
           const count = 100;

           class Snowflake {
               constructor() {
                   this.x = Math.random() * width;
                   this.y = Math.random() * height;
                   this.vx = (Math.random() - 0.5) * 0.5;
                   this.vy = Math.random() * 1 + 0.5;
                   this.size = Math.random() * 3 + 1;
                   this.opacity = Math.random() * 0.5 + 0.3;
               }
               update() {
                   this.x += this.vx;
                   this.y += this.vy;
                   if (this.y > height) this.y = -10;
                   if (this.x > width) this.x = 0;
                   if (this.x < 0) this.x = width;
               }
               draw() {
                   ctx.beginPath();
                   ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                   ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                   ctx.fill();
               }
           }

           for(let i=0; i<count; i++) snowflakes.push(new Snowflake());

           function animate() {
               ctx.clearRect(0, 0, width, height);
               snowflakes.forEach(flake => {
                   flake.update();
                   flake.draw();
               });
               requestAnimationFrame(animate);
           }

           window.addEventListener('resize', () => {
               width = canvas.width = window.innerWidth;
               height = canvas.height = window.innerHeight;
           });

           animate();
       }

       // --- 初始化 ---
       document.addEventListener('DOMContentLoaded', () => {
           renderBook();
           initSnow();
           updateZIndexes();
           
           // 新增滑動翻頁 (Touch Swipe) 邏輯
           const bookElement = document.getElementById('book');
           let startX = 0;
           const threshold = 50; // 最小滑動距離 (px)

           // 1. 記錄觸摸開始的位置
           bookElement.addEventListener('touchstart', (e) => {
               // 確保是單指觸摸
               if (e.touches.length === 1) {
                   startX = e.touches[0].clientX;
               }
           });
           
           // 2. 判斷滑動結束時的方向
           bookElement.addEventListener('touchend', (e) => {
               if (startX === 0) return; // 如果沒有記錄起始點，則忽略

               const endX = e.changedTouches[0].clientX;
               const diffX = endX - startX;

               // 由左向右滑動 (diffX > 0) 翻回上一頁
               if (diffX > threshold) {
                   flipPrev();
               } 
               // 由右向左滑動 (diffX < 0) 翻到下一頁
               else if (diffX < -threshold) {
                   flipNext();
               }

               // 重設 startX
               startX = 0;
           });
           
       }); 

   </script>
</body>
</html>
